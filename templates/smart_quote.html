<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>智能报价</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
{% extends "base.html" %}
{% block title %}智能报价 - 智管{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>智能报价</h4>
  <div>
    <!-- 已实现的批量导入页面 -->
    <a class="btn btn-success me-2" href="{{ url_for('smart_quote_bulk') }}" id="btn-bulk-import">批量导入</a>

    <!-- 公式编辑占位：改为静态路径，若后端存在 route 可替换为 url_for(...) -->
    <a class="btn btn-outline-secondary" href="/formula/editor" id="btn-formula-editor">公式编辑</a>
  </div>
</div>

<div class="table-responsive">
<table class="table table-sm" id="quotes-table">
  <thead><tr><th style="width:6%">ID</th><th>产品</th><th>公司</th><th style="width:10%">价格</th><th style="width:8%">数量</th><th style="width:12%">日期</th><th style="width:12%">操作</th></tr></thead>
  <tbody>
    {% for q in quotes %}
    <tr>
      <td>{{ q.id }}</td>
      <td>{{ q.product }}</td>
      <td>{{ q.company }}</td>
      <td>{{ q.price }}</td>
      <td>{{ q.qty }}</td>
      <td>{{ q.bid_date }}</td>
      <td>
        <button class="btn btn-sm btn-outline-primary btn-edit" data-id="{{ q.id }}">编辑</button>
        <button class="btn btn-sm btn-outline-danger btn-delete" data-id="{{ q.id }}">删除</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.btn-edit').forEach(btn=>{
    btn.addEventListener('click', function(){ alert('编辑：' + this.dataset.id); });
  });
  document.querySelectorAll('.btn-delete').forEach(btn=>{
    btn.addEventListener('click', function(){
      const id = this.dataset.id;
      if(!confirm('确认删除?')) return;
      fetch('/api/smart_quotes/delete', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id})})
        .then(r=>r.json()).then(d=>{ if(d.success) location.reload(); else alert('删除失败'); });
    });
  });
});
</script>
{% endblock %}
</body>
</html>